<!DOCTYPE html>
<html>
<head>
  <title>Failed Banks Visualization</title>
</head>
<body>

<style>
* {
  margin: 0;
  padding: 0; }
.ad {
  background-color: rgb(255,255,255);
  border: 1px solid black;
  position: relative;
  max-width: 1100px;
  min-width: 720px;
  width: 1100px;
  height: 480px; }
.svg-wrapper {
  background-color: rgb(200,200,200);
  margin: 0 auto;
  position: relative;
  width: 720px;
  height: 480px; }
h1 { font-weight: 400; }
h1.title {
  color: rgb(0,0,0);
  display: block;
  font-family: "Raleway";
  font-size: 30px;
  position: absolute;
  top: 10px;
  left: 0;
  text-align: left;
  text-transform: uppercase;
  z-index: 2; }
</style>

<script src="http://code.jquery.com/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js" type="text/javascript"></script>
<script src="js/raphael.js" type="text/javascript"></script>
<script src="js/data.js" type="text/javascript"></script>
<script type="text/javascript">

var Viz = function() {
  var _this = this;

  _this.biggest = 24;
  _this.height = 480;
  _this.realHeight = _this.height - 50;
  _this.width = 720;

  this.prep = function() {
    _this.paper = new Raphael( $('.svg-wrapper')[0], _this.width, _this.height );
    _this.monthOffset = _this.width / (window.months.length - 1);
  }

  /*
  this.draw = function() {
    var w = _this.monthOffset;
    var h = ( _this.realHeight / _this.biggest ) - 2;
    var x, y;
    for( var i = 0; i < window.months.length; i++ ) {
      var month = window.months[i];
      for( var j = 0; j < window.d[month].length; j++ ) {
        var item = window.d[month][j];
        x = (_this.monthOffset * i);
        y = Math.abs( _this.realHeight - ( (h * j) + 2 ) );
        _this.renderRect( x, y, Math.floor( w ), Math.floor( h ), item );
      }
    }
  }
  */

  this.drawItem = function( i, j ) {
    if( window.d[months[i]].length > 0 ) {
      var w = _this.monthOffset;
      var h = ( _this.realHeight / _this.biggest ) - 2;
      var x = (_this.monthOffset * i);
      var y = Math.abs( _this.realHeight - ( (h * j) + 2 ) );
      _this.renderRect( x, y, w, h, window.d[months[i]][j] );
    }
    j++;
    if( j < window.d[window.months[i]].length ) {
      var t = setTimeout( function() { _this.drawItem( i, j ) }, 10 );
    } else {
      j = 0;
      i++;
      if( i < window.months.length ) {
        _this.drawItem( i, j );
      }
    }
  }

  this.renderRect = function( x, y, w, h, data ) {
    var rect = _this.paper
      .rect( x, y, w, 0, 1 )
      .attr({
        'fill': 'rgb(0,0,0)',
        'stroke': 'none'
      }).
      animate({
        height: h
      }, 10, "<>" )
      .data( 'entity', data['Bank Name'] )
      .data( 'city', data['City'] )
      .data( 'state', data['State'] )
      .data( 'bought_by', data['Acquiring Institution'])
      .data( 'date', data['Closing Date']);
    //_this.bindRect( rect );
  }

  this.bindRect = function( rect ) {
    rect.mouseover( function() {
      console.log( this.data( 'entity' ) );
      console.log( this.data( 'city' ) + ', ' + this.data( 'state') );
      console.log( this.data( 'bought_by') );
      console.log( this.data( 'date' ) );
      console.log( new Date( Date.parse( this.data( 'date' ) ) ) );
    });
  }

  this.init = function() {
    _this.prep();
    //for( var i = 0; i < window.months.length; i++ ) {
      _this.drawItem( 0, 0 );      
    //}
  }

}

$(document).ready( function() {
   var v = new Viz();
   v.init();
})

</script>

<div class="ad">
  <div class="svg-wrapper">
    <h1 class="title">Bank Failures by Month</h1>
  </div>
</div>

</body>
</html>